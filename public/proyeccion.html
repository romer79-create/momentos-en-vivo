<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentos en Vivo - Proyección</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            color: white;
            overflow: hidden;
            font-family: sans-serif;
        }
        #projection-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #projection-container img {
            max-width: 95%;
            max-height: 95%;
            position: absolute;
            opacity: 0;
            transform: scale(1.05);
            transition: opacity 1.5s ease-in-out, transform 1.5s ease-in-out;
        }
        #projection-container img.visible {
            opacity: 1;
            transform: scale(1);
        }
        #placeholder {
            font-size: 2em;
            color: #555;
        }
    </style>
</head>
<body>
    <div id="projection-container">
        <div id="placeholder">Esperando fotos aprobadas...</div>
    </div>

    <script>
        const container = document.getElementById('projection-container');
        const placeholder = document.getElementById('placeholder');
        // IMPORTANTE: Reemplaza esto con la URL real de tu sitio en Netlify
        const NETLIFY_URL = 'https://playful-parfait-6bfab1.netlify.app';

        let currentIndex = -1;
        let photos = [];

        async function fetchApprovedPhotos() {
            try {
                const response = await fetch(`${NETLIFY_URL}/.netlify/functions/get-approved-photos`);
                if (!response.ok) return; // Si hay un error, no hacemos nada
                const newPhotos = await response.json();
                photos = newPhotos; // Actualizamos nuestra lista de fotos
                placeholder.style.display = photos.length > 0 ? 'none' : 'block';
            } catch (error) {
                console.error("Error cargando fotos:", error);
            }
        }

        function showNextPhoto() {
            if (photos.length === 0) return;

            // Oculta la imagen anterior si existe
            const currentImage = container.querySelector('img.visible');
            if (currentImage) {
                currentImage.classList.remove('visible');
            }

            // Calcula el índice de la siguiente foto
            currentIndex = (currentIndex + 1) % photos.length;
            const nextPhoto = photos[currentIndex];

            // Si la imagen ya existe en el DOM, la reusamos. Si no, la creamos.
            let nextImage = document.getElementById(nextPhoto.asset_id);
            if (!nextImage) {
                nextImage = document.createElement('img');
                nextImage.id = nextPhoto.asset_id;
                nextImage.src = nextPhoto.secure_url;
                container.appendChild(nextImage);
            }
            
            // Hacemos visible la siguiente imagen después de que la anterior se haya ocultado
            setTimeout(() => {
                nextImage.classList.add('visible');
            }, 500); // Pequeña pausa para una transición más suave
        }

        // --- INICIO DEL PROGRAMA ---
        async function start() {
            await fetchApprovedPhotos(); // Carga las fotos al iniciar
            showNextPhoto(); // Muestra la primera foto

            setInterval(showNextPhoto, 7000); // Cambia de foto cada 7 segundos
            setInterval(fetchApprovedPhotos, 20000); // Busca fotos nuevas cada 20 segundos
        }

        start();
    </script>
</body>
</html>