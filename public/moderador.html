<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Moderación</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        h1 { color: #333; }
        .container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .photo-card { background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; }
        .photo-card img { width: 100%; height: auto; display: block; }
        .actions { display: flex; justify-content: space-around; padding: 10px; }
        .actions button {
            border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;
            font-weight: bold; width: 45%;
        }
        .approve-btn { background-color: #28a745; color: white; }
        .reject-btn { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>Panel de Moderación - Fotos Pendientes</h1>
    <div id="pending-container" class="container"></div>

    <script>
        const pendingContainer = document.getElementById('pending-container');
        // IMPORTANTE: Reemplaza esto con la URL real de tu sitio en Netlify
        const NETLIFY_URL = 'https://68bb887586969bff15262a9a--playful-parfait-6bfab1.netlify.app/';

        async function handleAction(action, public_id, cardElement) {
            const response = await fetch(`${NETLIFY_URL}/.netlify/functions/${action}-photo`, {
                method: 'POST',
                body: JSON.stringify({ public_id: public_id })
            });
            if (response.ok) {
                cardElement.remove();
            } else {
                alert(`Error al procesar la foto.`);
            }
        }

        async function loadPendingPhotos() {
            const response = await fetch(`${NETLIFY_URL}/.netlify/functions/get-photos`);
            const photos = await response.json();
            
            pendingContainer.innerHTML = ''; // Limpia el contenedor

            photos.forEach(photo => {
                const card = document.createElement('div');
                card.className = 'photo-card';
                card.innerHTML = `
                    <img src="${photo.secure_url}" alt="Foto pendiente">
                    <div class="actions">
                        <button class="approve-btn">Aprobar</button>
                        <button class="reject-btn">Rechazar</button>
                    </div>
                `;
                
                card.querySelector('.approve-btn').addEventListener('click', () => handleAction('approve', photo.public_id, card));
                card.querySelector('.reject-btn').addEventListener('click', () => handleAction('reject', photo.public_id, card));

                pendingContainer.appendChild(card);
            });
        }

        loadPendingPhotos();
        setInterval(loadPendingPhotos, 10000); // Revisa si hay fotos nuevas cada 10 segundos
    </script>
</body>
</html>